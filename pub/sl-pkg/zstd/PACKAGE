NAME=zstd
DESCRIPTION="Fast lossless compression algorithm -- CLI tool"
VERSION="1.5.7"
ABOSULTE_VERSION=66823
URL="https://github.com/facebook/zstd/releases/download/v1.5.7/zstd-1.5.7.tar.gz"
BUILD_DEPENDS=(make binutils)
DEPENDS=(glibc gcc lz4 xz zlib)
OPTDEPENDS=()
PATCHES=()
METAPACKAGE=false

prepare() {
    return 0
}

build() {
    # because there's a 'build' dir in the zstd tarball, sl-pkg will attempt
    # to build from this directory, but we need to be in the tarball root
    if [ "$(basename $(pwd))" = "build" ]; then cd ..; fi
    make prefix=/usr || return 1
    make check
    return $?
}

do_install() {
    if [ "$(basename $(pwd))" = "build" ]; then cd ..; fi
    make prefix=/usr install
    return $?
}

postinst() {
    rm /usr/lib/libzstd.a
    return 0
}

detect() {
    OUT=$(zstdcat --version) || return 1
    declare -g VERSION=$OUT
}
